DROP PROCEDURE IF EXISTS `_idempotent_script`;

DELIMITER //

CREATE PROCEDURE `_idempotent_script`()
BEGIN
  DECLARE CurrentMigration TEXT;

  IF EXISTS(SELECT 1 FROM information_schema.tables 
  WHERE table_name = '__MigrationHistory' 
  AND table_schema = DATABASE()) THEN 
    SET CurrentMigration = (SELECT
`Project1`.`MigrationId`
FROM `__MigrationHistory` AS `Project1`
 WHERE `Project1`.`ContextKey` = 'RDB.Data.Migrations.Configuration'
 ORDER BY 
`Project1`.`MigrationId` DESC LIMIT 1);
  END IF;

  IF CurrentMigration IS NULL THEN
    SET CurrentMigration = '0';
  END IF;

  IF CurrentMigration < '201903261953538_Init' THEN 
create table `Autobus` (`spz` nvarchar(50)  not null collate utf8_bin ,`znacka` nvarchar(50)  not null collate utf8_bin ,primary key ( `spz`) ) engine=InnoDb auto_increment=0;
CREATE index  `IX_znacka` on `Autobus` (`znacka` DESC) using HASH;
create table `Znacka` (`znacka` nvarchar(50)  not null collate utf8_bin ,primary key ( `znacka`) ) engine=InnoDb auto_increment=0;
create table `Klient` (`email` nvarchar(50)  not null collate utf8_bin ,`jmeno` nvarchar(50)  not null collate utf8_bin ,`prijmeni` nvarchar(50)  not null collate utf8_bin ,primary key ( `email`) ) engine=InnoDb auto_increment=0;
create table `Kontakt` (`hodnota` nvarchar(50)  not null collate utf8_bin ,`typ` nvarchar(50)  not null collate utf8_bin ,`cislo_rp` nvarchar(50)  not null collate utf8_bin ,primary key ( `hodnota`) ) engine=InnoDb auto_increment=0;
CREATE index  `IX_typ` on `Kontakt` (`typ` DESC) using HASH;
CREATE index  `IX_cislo_rp` on `Kontakt` (`cislo_rp` DESC) using HASH;
create table `TypKontaktu` (`typ` nvarchar(50)  not null collate utf8_bin ,primary key ( `typ`) ) engine=InnoDb auto_increment=0;
create table `Ridic` (`cislo_rp` nvarchar(50)  not null collate utf8_bin ,`jmeno` nvarchar(50)  not null collate utf8_bin ,`prijmeni` nvarchar(50)  not null collate utf8_bin ,primary key ( `cislo_rp`) ) engine=InnoDb auto_increment=0;
create table `Jizda` (`cas` timestamp not null ,`linka` nvarchar(50)  not null collate utf8_bin ,`spz` nvarchar(50)  not null collate utf8_bin ,`cislo_rp` nvarchar(50)  not null collate utf8_bin ,`Pole` longtext,primary key ( `cas`,`linka`) ) engine=InnoDb auto_increment=0;
CREATE index  `IX_linka` on `Jizda` (`linka` DESC) using HASH;
CREATE index  `IX_spz` on `Jizda` (`spz` DESC) using HASH;
CREATE index  `IX_cislo_rp` on `Jizda` (`cislo_rp` DESC) using HASH;
create table `Trasy` (`linka` nvarchar(50)  not null collate utf8_bin ,`odkud` nvarchar(50)  not null collate utf8_bin ,`kam` nvarchar(50)  not null collate utf8_bin ,primary key ( `linka`) ) engine=InnoDb auto_increment=0;
CREATE index  `IX_odkud` on `Trasy` (`odkud` DESC) using HASH;
CREATE index  `IX_kam` on `Trasy` (`kam` DESC) using HASH;
create table `Lokalita` (`nazev` nvarchar(50)  not null collate utf8_bin ,primary key ( `nazev`) ) engine=InnoDb auto_increment=0;
create table `Mezizastavka` (`nazev` nvarchar(50)  not null collate utf8_bin ,`linka` nvarchar(50)  not null collate utf8_bin ,primary key ( `nazev`,`linka`) ) engine=InnoDb auto_increment=0;
CREATE index  `IX_nazev` on `Mezizastavka` (`nazev` DESC) using HASH;
CREATE index  `IX_linka` on `Mezizastavka` (`linka` DESC) using HASH;
create table `Jizdenka` (`cas` timestamp not null ,`linka` nvarchar(50)  not null collate utf8_bin ,`cislo` bigint not null  auto_increment ,`email` nvarchar(50) collate utf8_bin ,primary key ( `cislo`) ) engine=InnoDb auto_increment=0;
CREATE index  `IX_cas_linka` on `Jizdenka` (`cas` DESC,`linka` DESC) using HASH;
CREATE index  `IX_email` on `Jizdenka` (`email` DESC) using HASH;
alter table `Autobus` add constraint `FK_Autobus_Znacka_znacka`  foreign key (`znacka`) references `Znacka` ( `znacka`)  on update cascade on delete cascade ;
alter table `Kontakt` add constraint `FK_Kontakt_TypKontaktu_typ`  foreign key (`typ`) references `TypKontaktu` ( `typ`)  on update cascade on delete cascade ;
alter table `Kontakt` add constraint `FK_Kontakt_Ridic_cislo_rp`  foreign key (`cislo_rp`) references `Ridic` ( `cislo_rp`)  on update cascade on delete cascade ;
alter table `Jizda` add constraint `FK_Jizda_Autobus_spz`  foreign key (`spz`) references `Autobus` ( `spz`)  on update cascade on delete cascade ;
alter table `Jizda` add constraint `FK_Jizda_Ridic_cislo_rp`  foreign key (`cislo_rp`) references `Ridic` ( `cislo_rp`)  on update cascade on delete cascade ;
alter table `Jizda` add constraint `FK_Jizda_Trasy_linka`  foreign key (`linka`) references `Trasy` ( `linka`)  on update cascade on delete cascade ;
alter table `Trasy` add constraint `FK_Trasy_Lokalita_kam`  foreign key (`kam`) references `Lokalita` ( `nazev`) ;
alter table `Trasy` add constraint `FK_Trasy_Lokalita_odkud`  foreign key (`odkud`) references `Lokalita` ( `nazev`) ;
alter table `Mezizastavka` add constraint `FK_Mezizastavka_Lokalita_nazev`  foreign key (`nazev`) references `Lokalita` ( `nazev`)  on update cascade on delete cascade ;
alter table `Mezizastavka` add constraint `FK_Mezizastavka_Trasy_linka`  foreign key (`linka`) references `Trasy` ( `linka`)  on update cascade on delete cascade ;
alter table `Jizdenka` add constraint `FK_Jizdenka_Klient_email`  foreign key (`email`) references `Klient` ( `email`) ;
alter table `Jizdenka` add constraint `FK_Jizdenka_Jizda_cas_linka`  foreign key (`cas`,`linka`) references `Jizda` ( `cas`,`linka`) ;
create table `__MigrationHistory` (`MigrationId` nvarchar(150)  not null ,`ContextKey` nvarchar(300)  not null ,`Model` longblob not null ,`ProductVersion` nvarchar(32)  not null ,primary key ( `MigrationId`) ) engine=InnoDb auto_increment=0;
INSERT INTO `__MigrationHistory`(
`MigrationId`, 
`ContextKey`, 
`Model`, 
`ProductVersion`) VALUES (
'201903261953538_Init', 
'RDB.Data.Migrations.Configuration', 
0x1F8B0800000000000400ED5DDD6EE3B815BE2FD077307C59CCC6C96EB7680367179964A6986E3219C4338BA2370123338E1A5972F5132429FA64BDE823F5154A89A4C49F4389A465C9990EF66227A278787E3E1E91E790C7FFFDF77FE63F3FADA3C9234EB330894FA6470787D3098E836419C6AB936991DF7DF7C7E9CF3FFDF637F377CBF5D3E457FEDE0FE57BA4679C9D4CEFF37C733C9B65C13D5EA3EC601D0669922577F94190AC676899CCBE3F3CFCD3ECE86886098929A13599CCAF8B380FD7B8FA83FC7996C401DEE4058A2E93258E32F69CB42C2AAA938F688DB30D0AF0C9F4FAFCEDC139CAD1C1F9E9C574721A8588F0B0C0D1DD7482E238C9514E383CFE92E1459E26F16AB1210F50F4F97983C97B7728CA30E3FCB879DD5688C3EF4B21664D474E2A28B23C593B123CFA816965A676F7D2EDB4D61AD1DB3BA2DFFCB994BAD2DDC9F46D914D27EA38C767515ABE2368951AE080BCFE66C21FBEA90D4FF051FEF7667256447991E2931817798AA237934FC56D1406BFE0E7CFC9038E4FE2228A4486084BA44D7A401E7D4A930D4EF3E76B7CC7D8FC14A19C186826779DA97DEB9E72372A0B313C41EF7472899E2E70BCCAEF4FA63F12B8BE0F9FF0923F6040F8128704EBA44F9E16E4CF8F846B741BE1BA7DD63A6AA5ABF29FBB1FF9237A0C5795CD201EA6936B1C55ADD97DB8A1D3A134E10D6B7D9F26EBEB24A230A00F6F1649910625E789DAF219A52B9CCB2CCC670DA25A71C646B4475AF5BF51B0462DE70AB591ED4DCC84331F7B73ABEAF6E648F0B2F75914E238773138ED318AC5DFAD5118B99B9C751BD8BBBC0FD32C8F07419B32F2A2480718D71E62499CA3C00D63B4CB2820FB154585875F61DD06367539DCE0839EA72159715E84018E33FCB158DFE274448FCAB0423501F855D67E23BDD77858A059FBB642EF405FD93636A9D25A39E4AFE8CCD116235FAC79AB0FBFA41EE7995A368E325B29BFAE93759869D30559781DE08157756DD086692F707064DAE382F61805128A6372C5C6C07EEDFF6CD5B0F5B4E87492A6C9A0F850FF79E03C0DC6718CA1BE3B025FBC4E8ADC7BB2D051A8EC44404CFF76449EC4C1C0A827DBA871820F1532C6F5359FC8FC681994FCD36A5487AD2F38B32B4DDC54ADCDA4AE1F6A8B9EA6A5C7251825AAFB16F1B9819396C5571B3315E85B7861ED2A2BD5630327B46DAB55201BD5DEC1551DC609FF78BAAC9126DB39DEA0B454C430012865F4D39420048D1DEC645C5C24010B9303E8A720D6DE6CE601F8823623E0B79C3D06379A05CBC0BB2AD3DA2B06B6F5F7B69AD40D43F6F39AF7F916D9F552F92277D638EBB2370AEF7FB1388AE71B7471697424ADFE8359FE06721C6A9BE631B417FA5B8870D2DA52446A3072D4C372E473183C60A7C831EDF18A17241FE2FC0FBF07902608BFC89314FF19C738251B97E52794E7388D49CF25AEF4D735236802A7A7A488C526E7F5ED11CD110A962D03260B05DE0D7FA3992C52833659E456AF1D4D1B3BEC058D1BBA613030431B5D26EE6996254158F1D06CF658365316E55DBC9C1853D9D4AC2C194A0C4B266AB82153938C7832FD9DA61688561DFD6968B1A4AA4CED68AA4EE8ABF81C4738C793D3801E013943598096C042848C2B3F213E00A7E5E443D119B102F12A619CEB0E238C8370832213CF4A07970FF5AC26AEB690A5248E4BC760D2BACDA8C241097DE87A04454B5D4A99CF04D4B483090A899BA0D09ACF6940512725ED41D61A79D728D3B8FDBE81AE45061B2040D91627F8B558679BF107C4208B117581440D19F5823C35C2DD10E591AB7DC59BCCB98DA95BB3385E98934D62C30398E81E057D4D8CD484112060AAC0C305717A90B5FDE33C3ED2348E6D0C0C1E57740297A6769B619BA4C38860EA706470E47B6B48BD3E1706F13DAC03834C61EDBEF6C17BC1315D13503A02BC0D62585CC21E82ED41618172138951D1A812F782542B1F836C035A756CC38194501811547AD4BDDDF82D21F8AD81650EDB0F0D2D23270382CBA8692BD72567CB46FC4C522CB47FD49438E8D61F493972DA05CC7DF9444A5C5B01ADAF4FA3A47F9B915BD21803814B8BF99B10614E0034B0A8B34DF64033A60DAC5CD5D88033713F887B3359649BC107445CBB4333A4767AC1DA6B736B20DF033936D00EAFC3B5C9991013280C699106143CF7678F3338972286DE58724626797870D0D3E20B64C0C668E0C52627BC80EAB4195ACA068E8917BA56EAB0AD92B7EA012D72B2AB6BEDD62F50A4B16D8C051FEAF5F103AEC092146F1D7CE88FDFDE71481399556C388C715AEF3BEE103178F9183F41070FBE64989D3DC8583659C55749768173F9BE6793361563A81A36E5BEF44803D09965343BBAD3990DF5E77EB08B407D1E5FA7C0931876242A7D99C9809778545234FE0551E191431B02C6FE9DDD2B8042DDD9EAA5A33B5F2D42149A85760711B62A8068D4EBB20E12743E4314B80B550808F3478235BFAC2CB46B3799D569DC96FDAF19AD278DE605DA12FE42773E6FD455A12C898594E0552C5DDECEF4B4C47A5B825A10A2997C2D6A684B49EBB4D82CEC4D2D7CDE993502E5184001943C83AF1E94EC8240A6F61E5B4B2F5C57D00537E4E980188F98A953F96C1756CFCD754D1D6F29CD1636E790005ECDD6B5167708CB1A8E9EEBC25BE4331C321A822CFC1BD3A28EF61C86404BF8E0F4A419E084BB49371D6179A7C0BC8F7ECCA1F81D6948BAB4639A2E40E8A5339AEC3359E4404BA7FE3CC4D58F2CEB32B78738ED829C02EFCDDAA7457E6358734766578E489B95D0657A38EEE62BFEEE01A01C77D5056F890259C4810496EB056B8BDC70E4475C45F0BD505F82B33D83516E209AD11DCFF0935A8E6074FA8B1699F9F1DE7A575CB7CD67B4921B7B309F194ABECD2FD16613C62BA1041C7B3259D0FA6F67DF2DDCCBA3AD298D5920ADABD43D7C3D529EA4688595D67295B8C4D5FDFAF262C02D2A0F7E9F2DD7DA6B4A0CC0B09DE28389DB7CDD547C8BC5DF2EFFCD3EA9421DBC0360C1D868EE3D11665D0664AA73FFF25A4FEF35298BEEA108A57089B5B3242AD6317D946D5EA0E08C8982700A58A4F212A3E00181519E99228116D5D114A4C5F1656D5BD9826DFFBC8D016E5D2DCC61E86752E72BD024F79ADEAA84BDBF852E4D1D4DCA64F16B519B180E699B6908A537443A7F270C262E74EA421A22954D1A9684C27DB22EDF59FB9B9745013DEC6BEA69522A2BAF25AAF43E5996615917D3D0088E48247FDEB810004F048BF482308B929B14243AAE9D69F4675B5B43C12D7B7BC3BDB7B6D6488AE591076F9DC2E1130B759A3A9A34E909D86F9E52CA1C6C67675F333BCC9750D56580801D849980948313E944610C2F4C4C949A13EE5B2C38A1F3CBDB4297D6BC11A9D0277B8335B643F7C61A1868B0C09AA19F71F5DA074A94539E22AD64F9502C5D68490792454A0F68BD47E66D824FDE1636C5D32C8C6CEE6ABF4B89D10B7EDC238DD681316F85F2D4A9BB3E8D3D7B50677F4E7A24C3F01096B75D5842DADD2CA68E2ECEACFAB8B8D8453A48B5D54654383A33E8C77CA738D1628BEA2BF5E8758C518925CE595CAFFB3726B4401F7D653A212A7A0C976590EFF279F18F88550E29FFC903D9FC8D4B14877738CB694990E98F073F2A3F56B13F3F1C31CBB2A51477827F3D42369555451360BDD65DCEA4EA448F95C48F280DEE51AAD5E8702CFEC103632A55ED74D68778899F4EA6FFACFA1D4F3EFCF586767D33B94A89518F2787937FB931E3F8C3091E4A86A37EDD7A36296527D2818779ADC403BD5FB774582C4FD3178ED806B55FA2CD7E75184B4091333B53180266DDC6A83BF6ABB92A9AE331A7493FFF09ADB3D16C233D78E19D07F030E6EA2756D6076267DD96074DB413E9C0EBE8568299C200DDD2992DFFCDCF40C7F1EDCC012D5381F7C065A885CD4AF25403E54F9065395A6FCA651B26C6AC1660EE9A659C78CCFEAA679FBE085C3C593042FA7D452E5167482C551D25844C753ABF21A217A3732C79EC01744F001BD0B69D7E58B8CCC35A55CF3E4D55C5DB3C1821FD06F8881AEEDB5A191C0CD5741B9C751BC46B8301A92DA4EB13F8063D5840A3EAD9274647F3F8AE954F7D97437D7D576DDC3DCA20AD8CF445D6B939EAE973C8D9B90D57611929EAACC2EA388861C76B2173D5D31293F61F4A9F9A9EEC4A907E556D8757BBA54B41EE4544BDEE6F9A8E88D94677262E3730E1C3812E43ED67894E7ABCC3741B7010C4D4D718A1AB8D3B414EFB311AAB5DBB1378CC47B4ACC7DA9FE29AFC3A1270F7F32B858BF184907D18646770691B702F4A625A7C0F760414763BA0AB9A404F20B1FD4080C76F5C8B2D6D33D25ED5B61CD18F0C0B8FA17D883D4C46F6206E65299BAB6EE0CDFDAE3A21CA0D459F7A835ED66F392D641F0370ACFD673516782E6B2F2B477EB37CBF96379CEDDB9BA28E9666FA2A3E0EF656331C1BDAC987C138D63E556674740B3B014B5DF505AA04F3357815F3D94C87D1F6A6BAE2B89E6578B00CE95D5C9032A67FB12B8FC8CF238A9106FBEA85EA1D71AF52797EF12DD38D4FCB93614E26371E1076186C5F0A1C5A7EF6F7C9D60E1B3DF8E8F24EFC8003287A606BA0BA847AE90215047295B72AD4D5E475C400183D0B7D325DDE96292D9A153A2DF2E4D6B622A1B9202144FA6FF0F1569532776E1A69DE00D1FEC5A98E615B1943907AD9F8E054E3B0ABC421340C696123159D43F12895360A6F8006B80E97616047DA5C1C1122FC97F065D96D59B6C2D108B3E7A04A5294E93F63A9126E96DA1AEDA609227F913CA028040EC2AA23D48B236D80BA05A27F895FC21794E5E8D102F8DC436B43F00693E63174086337C51AA5692FD4BAD0FDA1127C177A40054FF7AB22A33881B54BEB6DA22AFE452A70D09FC83D545B94DD8778937C3CF1B62EA768013468A1A5EAA03751FAA999E86CA5DD89B5B3B288AA0397AFA8B6092B7D5384EBCB7D09BBA34A87FB28702F850B2DD91B08B03D1727F4B79AB27E90AE0CF727E6D6B5077DACB75BD17AAB2E286F2BC4D2526DC2C96B32F14A716FA26D5B3FD072F6F42E96438940FDBA2ED916177179BA94FE758EB370D59098139A310EA40D71FDCE87F82EE1DB728523FE8A5AAE0EE7684976CBA7691EDE91B50A690E7096553F195F55932AAB86DDE2E587F8AAC837454E44C6EBDB48DA7794FBFBB6F1AB3A8832CFF3AB4DF957D6870884CD908880AFE2B745182D6BBEDF03078B0D24CAC0013BA45ADA322F0FABAE9E6B4A1F93D89210535F1DEFF88CD79BB2C24B76152F50093C77DEBE64F802AF50F0CC2F5D9B89741B4256FBFC3C44AB14AD3346A3E94FFE24185EAE9F7EFA1F7CDD9CEB3FA10000, 
'6.2.0-61023');
  END IF;

END //

DELIMITER ;

CALL `_idempotent_script`();

DROP PROCEDURE IF EXISTS `_idempotent_script`;

