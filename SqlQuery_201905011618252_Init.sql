DROP PROCEDURE IF EXISTS `_idempotent_script`;

DELIMITER //

CREATE PROCEDURE `_idempotent_script`()
BEGIN
  DECLARE CurrentMigration TEXT;

  IF EXISTS(SELECT 1 FROM information_schema.tables 
  WHERE table_name = '__MigrationHistory' 
  AND table_schema = DATABASE()) THEN 
    SET CurrentMigration = (SELECT
`Project1`.`MigrationId`
FROM `__MigrationHistory` AS `Project1`
 WHERE `Project1`.`ContextKey` = 'RDB.Data.Migrations.Configuration'
 ORDER BY 
`Project1`.`MigrationId` DESC LIMIT 1);
  END IF;

  IF CurrentMigration IS NULL THEN
    SET CurrentMigration = '0';
  END IF;

  IF CurrentMigration < '201905011618252_Init' THEN 
create table `Autobus` (`spz` nvarchar(50)  not null collate utf8_bin ,`znacka` nvarchar(50)  not null collate utf8_bin ,primary key ( `spz`) ) engine=InnoDb auto_increment=0;
CREATE index  `IX_znacka` on `Autobus` (`znacka` ) using HASH;
create table `Znacka` (`znacka` nvarchar(50)  not null collate utf8_bin ,primary key ( `znacka`) ) engine=InnoDb auto_increment=0;
create table `Klient` (`email` nvarchar(50)  not null collate utf8_bin ,`jmeno` nvarchar(50)  not null collate utf8_bin ,`prijmeni` nvarchar(50)  not null collate utf8_bin ,primary key ( `email`) ) engine=InnoDb auto_increment=0;
create table `Kontakt` (`hodnota` nvarchar(50)  not null collate utf8_bin ,`typ` nvarchar(50)  not null collate utf8_bin ,`cislo_rp` nvarchar(50)  not null collate utf8_bin ,primary key ( `hodnota`) ) engine=InnoDb auto_increment=0;
CREATE index  `IX_typ` on `Kontakt` (`typ` ) using HASH;
CREATE index  `IX_cislo_rp` on `Kontakt` (`cislo_rp` ) using HASH;
create table `TypKontaktu` (`typ` nvarchar(50)  not null collate utf8_bin ,primary key ( `typ`) ) engine=InnoDb auto_increment=0;
create table `Ridic` (`cislo_rp` nvarchar(50)  not null collate utf8_bin ,`jmeno` nvarchar(50)  not null collate utf8_bin ,`prijmeni` nvarchar(50)  not null collate utf8_bin ,primary key ( `cislo_rp`) ) engine=InnoDb auto_increment=0;
create table `Jizda` (`linka` nvarchar(50)  not null collate utf8_bin ,`spz` nvarchar(50)  not null collate utf8_bin ,`cislo_rp` nvarchar(50)  not null collate utf8_bin ,`cas` timestamp(5) not null ,primary key ( `cas`,`linka`) ) engine=InnoDb auto_increment=0;
CREATE index  `IX_linka` on `Jizda` (`linka` ) using HASH;
CREATE index  `IX_spz` on `Jizda` (`spz` ) using HASH;
CREATE index  `IX_cislo_rp` on `Jizda` (`cislo_rp` ) using HASH;
create table `Trasy` (`linka` nvarchar(50)  not null collate utf8_bin ,`odkud` nvarchar(50)  not null collate utf8_bin ,`kam` nvarchar(50)  not null collate utf8_bin ,primary key ( `linka`) ) engine=InnoDb auto_increment=0;
CREATE index  `IX_odkud` on `Trasy` (`odkud` ) using HASH;
CREATE index  `IX_kam` on `Trasy` (`kam` ) using HASH;
create table `Lokalita` (`nazev` nvarchar(50)  not null collate utf8_bin ,primary key ( `nazev`) ) engine=InnoDb auto_increment=0;
create table `Mezizastavka` (`nazev` nvarchar(50)  not null collate utf8_bin ,`linka` nvarchar(50)  not null collate utf8_bin ,primary key ( `nazev`,`linka`) ) engine=InnoDb auto_increment=0;
CREATE index  `IX_nazev` on `Mezizastavka` (`nazev` ) using HASH;
CREATE index  `IX_linka` on `Mezizastavka` (`linka` ) using HASH;
create table `Jizdenka` (`linka` nvarchar(50)  not null collate utf8_bin ,`email` nvarchar(50) collate utf8_bin ,`cas` timestamp(5) not null ,`cislo` bigint not null  auto_increment ,primary key ( `cislo`) ) engine=InnoDb auto_increment=0;
CREATE index  `IX_cas_linka` on `Jizdenka` (`cas` ,`linka` ) using HASH;
CREATE index  `IX_email` on `Jizdenka` (`email` ) using HASH;
alter table `Autobus` add constraint `FK_Autobus_Znacka_znacka`  foreign key (`znacka`) references `Znacka` ( `znacka`)  on update cascade on delete cascade ;
alter table `Kontakt` add constraint `FK_Kontakt_TypKontaktu_typ`  foreign key (`typ`) references `TypKontaktu` ( `typ`)  on update cascade on delete cascade ;
alter table `Kontakt` add constraint `FK_Kontakt_Ridic_cislo_rp`  foreign key (`cislo_rp`) references `Ridic` ( `cislo_rp`)  on update cascade on delete cascade ;
alter table `Jizda` add constraint `FK_Jizda_Autobus_spz`  foreign key (`spz`) references `Autobus` ( `spz`)  on update cascade on delete cascade ;
alter table `Jizda` add constraint `FK_Jizda_Ridic_cislo_rp`  foreign key (`cislo_rp`) references `Ridic` ( `cislo_rp`)  on update cascade on delete cascade ;
alter table `Jizda` add constraint `FK_Jizda_Trasy_linka`  foreign key (`linka`) references `Trasy` ( `linka`)  on update cascade on delete cascade ;
alter table `Trasy` add constraint `FK_Trasy_Lokalita_kam`  foreign key (`kam`) references `Lokalita` ( `nazev`) ;
alter table `Trasy` add constraint `FK_Trasy_Lokalita_odkud`  foreign key (`odkud`) references `Lokalita` ( `nazev`) ;
alter table `Mezizastavka` add constraint `FK_Mezizastavka_Lokalita_nazev`  foreign key (`nazev`) references `Lokalita` ( `nazev`)  on update cascade on delete cascade ;
alter table `Mezizastavka` add constraint `FK_Mezizastavka_Trasy_linka`  foreign key (`linka`) references `Trasy` ( `linka`)  on update cascade on delete cascade ;
alter table `Jizdenka` add constraint `FK_Jizdenka_Klient_email`  foreign key (`email`) references `Klient` ( `email`) ;
alter table `Jizdenka` add constraint `FK_Jizdenka_Jizda_cas_linka`  foreign key (`cas`,`linka`) references `Jizda` ( `cas`,`linka`)  on update cascade on delete cascade ;
create table `__MigrationHistory` (`MigrationId` nvarchar(150)  not null ,`ContextKey` nvarchar(300)  not null ,`Model` longblob not null ,`ProductVersion` nvarchar(32)  not null ,primary key ( `MigrationId`) ) engine=InnoDb auto_increment=0;
INSERT INTO `__MigrationHistory`(
`MigrationId`, 
`ContextKey`, 
`Model`, 
`ProductVersion`) VALUES (
'201905011618252_Init', 
'RDB.Data.Migrations.Configuration', 
0x1F8B0800000000000400ED5DDD6EDCB815BE2FD07710E6B2C87AECDDB6D81AE35D38765264D78E034FB2287A63D012EDA8D64853FD18B68B3E592FFA487D85521229F1E75022391A49D90DF66263513C3C3F1F8FC873C833FFFBCF7F573F3E6D22EF11A75998C4278BA383C38587633F09C2F8FE6451E477DF7CBFF8F187DFFF6EF526D83C79BFB0F7BE2BDF233DE3EC64F139CFB7C7CB65E67FC61B941D6C423F4DB2E42E3FF093CD1205C9F2DBC3C3BF2C8F8E96989058105A9EB7BA2EE23CDCE0EA0FF2E75912FB789B1728BA4C021C65F43969595754BDF76883B32DF2F1C9E2FAFCF5C139CAD1C1F9E9C5C23B8D42447858E3E86EE1A1384E7294130E8F3F65789DA7497CBFDE920728FAF8BCC5E4BD3B146598727EDCBE6E2AC4E1B7A510CBB62323E517599E6C2C091E7D47B5B294BB3BE976D1688DE8ED0DD16FFE5C4A5DE9EE64F1BAC8169E3CCEF1599496EF705AAD0D70405E7FE5B187AF1AC3137C94FFBDF2CE8A282F527C12E3224F51F4CAFB50DC46A1FF337EFE983CE0F8242EA2886788B044DA8407E4D18734D9E2347FBEC67794CD0F11CA89819662D7A5DCB7E92976AB65218627E85D7897E8E902C7F7F9E793C59F085CDF864F38600F28103EC521C13AE993A705F9F33DE11ADD46B8695F768E5AE9AAFCE7FE477E8F1EC3FBCA66100F0BEF1A47556BF639DCD6D3A134E10D6D7D9B269BEB24AA61503FBC592745EA979C2772CB4794DEE35C6461B56C11D589333AA239D2AAFF4D82B5DA72B6509BD8DEC44C3873B137B3AA6A6F8604277B9F45218E731B83D73D26B1F89B0D0A237B93D36E237B97B7619AE5F1286893465E17E908E39A432C8973E4DB61ACEE3209C87E4151E1E05768B7914D5D0E37FAA0E76948569C17A18FE30CBF2F36B7389DD0A352ACD49A00FC2A6DBF11DE6B3D2CD0AC7C5BA177A0AF6C179BB5D23A3964AFA8CCD52D5ABE68F34E1F7E413DD633B56C9C64B6D6FCDA4ED671A64D1F64E17580035EE5B54117A69DC0C190698E8BBAC72490901C932D3646F66BBFB155C3CED3A2D749EA2683E443DDE781F53498C63186EAEE087CF13A2972E7C9528F52CB4E04C4F5DF96C813381819F5641B354DF0A142C65CD6505574099874159337556B3BDF9A87CA7AA46D197075541355A73DFF5CC349C7BAA88B990A8F1DBCD0769995EAB18693BA6DA7051A1DD5DCF7541DA689CC387A93897CC039DEA2B454C438B12169F4D39420044D1D87A45C5C243E8D6003E8AF41ACBCD9CE03F0056546C06F597B0C66340396817765A69557346CABEFED34A95B86CCE735EBF335E8EAA4F2756EAD71DA65360A1F7E1D3789E71B75DDA775249DFE835AFE06721C729BE2319417865B8830D2CA524468D07234C072E463E83F60ABA06EDDE30B5E90BC8BF33FFF11401A27FC3A4F52FC571CE394EC29820F28CF711A939E01AEF437AB1921EFBEABBCCE40B91283BD8FDBD6511F3CA0892C60B2D4C0BB616FB493456850268BD8EAB4A3E96287BEA070536F1834CCD48D3613F734CB123FAC7868377B34D1288AF2260E3C6D96B9C603CD53124490891A6EC9D424239E2CFEA0A805A2D504665A5A34DF29523B5AC813FA2A3EC711CEB177EAD7A733CE50E6A30058889071C527C407E0B49C7C283A2356205E258C73D56184B11F6E51A4E359EA60F3A15E36C4E516B294C471E918745A3719953BC3A00EDD8C2069A94F29AB25879A6E3041D16A1D143A532D2D289A7CA139C83A83E20AE53AA43E37D075C860020428116205BF0EEBEC32FE8818A431A23E90C821A3419027079F5BA22C723557BC899C9B98BA33C1E28439D124263C8039E849D0D7C64875180102A6123C6C10A70659BB3FCED3234DE1D8C4C0E049422B70296A3719B6CD074C08A61E470647BE7786D497E7C220BEC7756090298CDDD71CBC171CD3D501A527C0DB2286C625CC21D81D14E628B79118198D3271274875F231CA36A053C7261C0809850941A546DDBB8DDF1182DF1958FAB0FDD8D0D2723222B8B49A36725D62B66CC2CF648D85EE8F9A1407DDF92329464EFB8039974FA4C0B511D086FA340AFA3719B9238D3112B89498BF0E11FA04400B8B26DB640E346DDAC0C8554D0D381DF7A3B8379D4576197C44C4753B344D6A6710AC7D696E0DE47B24C706DAE1CB706D622644070A4D5AA40505CBFD99E30CCEA5F0A1379A9C11491E1E1C0CB4F8021930311A78E7C80A2FA03A4D8616327253E2A55E2BF5D856CA5B0D801631D9D5B7761B1628C2D826C682CFDBBAF8015B60098A370E3E0CC7EFE038AC1399556C388C71DAEC3BEE103178F9183F41070F3E65989E3DC8681A5AC65749768D73F12A669B36E563A80A36C5BEF59106A033CD68F674AF6736D49FF9C13E02CD517995024B629891A8F4A52703DEAF9149D5F12F880A8B1C9A10D0F6EFED5E0114EA4E572F3DDDD96A11A2D02EB47B88D0550144A35997F590A8E7334481B9508900377F0458B37BC45CBB72C9589EC65DD9FF86D166D2285EA02BE1CF7567F3465E158A92184809DE9252E5ED4D4F0BAC7725A83921DAC9D7A186AE94B44A8BCEC2C1D4C2E69D5E23508E011440CA33B8EA41CA2E70641AEFB1B3F4DC750555704D9E0E88F1F0993A99CF6E61D5DC5CDFD47196526F617D0E09E0556F5D6371C7B0ACE6E8B92ABC413EC322A3C1C9C2BE311DEAE8CE6170B4B80FCE409A014EB8EB74D31396B70ACCBBE8471F8ADF9386844B3BBAE902845E7AA3C92E93450CB4F4EACF415CF5C8B22A737788D32CC8C9F1DEAE7D3AE4D78635F76476E988B45E097DA687E36EAEE2EF1F00D2715755F08E2890411C8863B959B076C80D477EF85504DB0B0D2538DD3368E506A219FDF10C37A9C50846AFBFE890991DEF6D76C54DDB6A591759A30F564B4D35B6D525DA6EC3F89EABCE469F78EBBA34DBD9376BFBCA659B9AC6D217D655F21EBE19294F52748FA5D6729518E0EAEA7B7931E0169507BFCF828DF29A1403D06CA7D860FC365F3515DB62B1B7CB7FD34F2A57A2EE005830B69A7B4B84D9940199EADCBFB8D6537B79653D3C14A114AE7E769644C526AE1F65DB172838A3A3C09D02E6A9BCC4C87F406094672949A04475140529717C51DB46B6A0DB3F6763805B57037368FAE9D4F9056892794D6755C2DEDF4097BA8E3A65D2F835AF4D0C87B4F534B8AA183C9D7F1006131B3A4D8D0B9ECA360D4B42E19CACCB76D6EEE6A5514007FBEA7AEA944A2B5FF12AFD9C046558D6C63475048727923F6F6D08802782797A7E9845C94D0A129DD6CE75F467575B43C12D737BC3BD77B6D6448A659107679DC2E1130375EA3AEA34E908D8AF9E52C81CEC666757335BCC9750D6A58F801D849E809083E3E944610C2F4C7494DA13EE3B2C38A1F3CB33F7B5747FED8C14304C6080144D3FEDDA73081B4B6734795A49F0500436B484E3C43CA507B4999179DBD091B38575D1300323EBBB9AEF3162F4821F67A4D126ACE5AC5096F8B4D7A7B6E700EA1CCEC54E6418168072B60B4D27DB9B45D7D1C699559F86693E7DC281AA9D36A4DC111A838FFA5E71A24406E5579AD19B08A114095CD1A85CFF8F372861BAFA958547D4F318066588EEF279FDCF88D6FD28FFC9C2D0EC8D4B14877738CBEB821E8BEFCB5FA2107E05623EBFC8B0CCB240881AC13FCB209ACAA81E09B0DAEA2F465275AA0F85C48F28F53FA35429CD6159F38385B564AACAD9AA7771809F4E16FFAAFA1D7BEFFE7653777DE55DA5C4A8C7DEA1F76F3B662C7F91C041C970CCAE5FCF3AA5EC453AF028AE9178A0CFEA970EF3055E86C211DD5E0E4BB4DD6D8E630928EE65660A4DB8ABDF184DC7613557C5621CE634E9E73EA15536DA4DA0032FACF3081E465FBBC4C8FA40E4ABDFF2A089F6221D7899DC4830DD26BE5F3ABDE5BFFA19E830BD9939A0C525F01EB82C36B05949BED640F9DB5E598E36DB72D9868931AB0598BD6629270EB3BFEA39A42F02174F068C907EBF459708DD443302A923F83448D94DD934D4E5A0E9AAE79076AF62650E8C907E23585B73D3D5C8E06098A5DFE0B4DB281E170C26ED20DD90C0D7E8C1001A55CF21313A99B7B6AD39EABA9419EA9B68E2AA51066965A2AFA9CACDD1409F32C6CE6D781F96519EDEFAA796836876AB0632573D0D31A9D62C1DB29A26BD8CA35E12DBE3A56AE13A8E7DF94EA79B93BAC359A69119CFE6EE237C2CCF66A87916C7AC0F56E8EEE18D8298E6022174A9702FC8E93EC062B4E3B6028FFE7094F158F3296BC92E0201B72E7FA570D19ECD310F61EC0D2E5D03CEA218A5C1F7604F40A1E7F2FBEEF10F0412D30F0478F0C5B6CCD12E23CDAAAAE4847E645C788CED43CC6132B107B12B08D95E3203EFCCF755E890EE06BA54FA73B27EC7491FF3188065D53DA3B1C03355B3ACD9F8D5F2C35A5E732E6F36E5140DCDF4ABF838985B4D7304692F1F06ED5873AA8968E916F60296A6DE0A5483E5D7E055F4E72A2D469B4D5DC3693DCBF86019D3BBD820654AFF625698909D25E4230DE67503E5DBD94E45EADCE25BBABB9686A7BAAC4CAE3DDC6B31D85C4A0B1A7EF6E7646B8B8D9EE6B0F03EFC80052806606BA48A806AD1001904627DB52AD4D5E675F800587D8EF96411DC9629AD3A2B745AE4C9AD692D407D294088F4DFE1A3A93265E6DC14D2AC01A2FDB35505C1AE028220F5B2F1C1AABA605F71416818D242472A7A8762512A6514D6000D701D06A16F465A5F961022FC53F812F45B96AE7014C2F439A8921465EA0F48CA84DBA5B642BB6D82C85F240F280A8143ACF208CDE24819A06981E85FE297F00565397A34003EF3D0CA10AC41A7790C1DC2D84F994461DA735526547F2805DFB91E50A9D179D542E427B0725DBC4B54C9BF08A505861379803A87A2FBE0EF704F27DECE850C0D80062DB4641D0C26CA30D50AADADB43FB1F656905076E0E2F5D22E61856F0A77F5782861F75463708E020F5232D090BD91003B70594077AB49EB07E1BAEF7062EE5CF5CFC57AFB156DB0BA7EE2B6822FEAD4259CB826E3AF030F26DAAE95FB0C67CFE0625914E753AFDA926D711197A74BEBBFCE7116DEB7245684668C7D6143DCBCF32EBE4BD8B65CE288BD22178AC3390AC86EF934CDC33BB25621CD3ECEB2EA57DEAB3A4E65BDAE5B1CBC8BAF8A7C5BE44464BCB98D847D47B9BFEF1ABFAA4028F2BCBADA967F65438840D80C8908F82A7E5D8451D0F0FD163858AC2151060EE821D5D296797958F5FEB9A1F43E890D0951F535F18E8F78B32D6BAB6457F11A95C0B3E7ED53862FF03DF29FD985693D917E43886A5F9D87E83E459B8CD268FB933F098683CDD30FFF07EFA762A154A00000, 
'6.2.0-61023');
  END IF;

END //

DELIMITER ;

CALL `_idempotent_script`();

DROP PROCEDURE IF EXISTS `_idempotent_script`;

